---
import { marked } from "marked";
import type { ImageWithCaptionElementModel } from "@/api";
import { Image } from "astro:assets";

const { data } = Astro.props;
const typedData = data as ImageWithCaptionElementModel;

const baseUrl = import.meta.env.PUBLIC_BASE_URL_HTTPS;

let src: string = `${baseUrl}${typedData?.properties?.image[0]?.url}`;

if (typedData?.properties?.image[0].focalPoint !== null) {
  src += `?rxy=${typedData?.properties?.image[0].focalPoint.left},${typedData?.properties?.image[0].focalPoint.top}`;
}

const caption: string = typedData?.properties?.caption;
const alt: string = typedData?.properties?.image[0]?.properties?.altText ?? caption;
---

<figure>
  <Image
    src={src}
    alt={alt}
    width={typedData?.properties?.image[0]?.width}
    height={typedData?.properties?.image[0]?.height}
  />
  <figcaption set:html={marked.parse(caption)} />
</figure>
