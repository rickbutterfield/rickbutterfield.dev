---
import { marked } from 'marked';
import Page from "@/layouts/Page.astro";
import { ContentResource, OpenAPI, type ContentPageContentModel } from '@/api';

export async function getStaticPaths() {
  OpenAPI.BASE = import.meta.env.PUBLIC_BASE_URL;

  // Fetch all content of type "page" from Umbraco sorted by creation date in ascending order.
  const pages = await ContentResource.getContent20({
    filter: ['contentType:contentPage'],
    expand: 'all'
  })

  // Create a page for each one using the slug as the route, and pass in the props.
  return pages.items.map((page: ContentPageContentModel) => ({
    params: { slug: page.route.path.replaceAll("/", "") },
    props: { name: page.name, content: page.properties.content }
  }));
}

const { name, content } = Astro.props
---

<Page name={name}>
  <article>
    <h1>{name}</h1>
    <div set:html={marked.parse(content)}></div>
  </article>
</Page>